/**
 * Adam Engebretson
 *
 * Adam Engebretson <http://github.com/adamgoose>
 * Created and maintained by Adam Engebretson
 *
 * Copyright (c) 2014 Adam Engebretson.
 * Licensed under the MIT License (MIT).
 */
"use strict";angular.module("adamgoose.webdis",[]).service("WebdisSocket",["$timeout",function(s){this.callbacks={},this.scopes={},this.init=function(t,i){this.socket=new WebSocket("ws://"+t+":"+i+"/");var n=this;return n.socket.onopen=function(){angular.forEach(n.callbacks,function(t,i){s(function(){n.socket.send(angular.toJson(["SUBSCRIBE",i]))},5)})},n.socket.onmessage=function(s){var t=angular.fromJson(s.data).SUBSCRIBE,i=t[0],o=t[1],e=t[2];"message"==i&&n.dispatchEvents(o,e)},this},this.dispatchEvents=function(s,t){var i;try{i=angular.fromJson(t)}catch(n){i=t}this.callbacks[s](i,s),angular.isUndefined(this.scopes[s])||this.scopes[s].$apply()},this.subscribe=function(s,t,i){this.callbacks[s]=t,this.scopes[s]=i}}]).provider("Webdis",function(){this.host=null,this.port="7379",this.setHost=function(s){this.host=s},this.setPort=function(s){this.port=s},this.$get=["WebdisSocket",function(s){var t=this.host,i=this.port;return s.init(t,i)}]});