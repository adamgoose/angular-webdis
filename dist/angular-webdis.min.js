/**
 * Adam Engebretson
 *
 * Adam Engebretson <http://github.com/adamgoose>
 * Created and maintained by Adam Engebretson
 *
 * Copyright (c) 2014 Adam Engebretson.
 * Licensed under the MIT License (MIT).
 */
"use strict";angular.module("adamgoose.webdis",[]).provider("Webdis",function(){function s(s,t,e,i,h){if(this.xhr=new XMLHttpRequest,this.received=0,this.scope=null,this.messageCallback=function(){},this.subscribeCallback=function(){},this.create_subscribe_url=function(e){return"http://"+s+":"+t+"/SUBSCRIBE/"+e},this.receive=function(){if(3==this.readyState){var s=this.responseText,t=s.slice(this.parent.received);this.parent.received=s.length,t=angular.fromJson(t).SUBSCRIBE,this.parent.dispatchCallbacks(t)}},this.dispatchCallbacks=function(s){var t=s[0],e=s[1],i=s[2];switch(t){case"subscribe":this.subscribeCallback(i,e);break;case"message":this.messageCallback(i,e)}null!=this.scope&&this.scope.$apply()},this.onSubscribe=function(s){return this.subscribeCallback=s,this},this.onMessage=function(s){this.messageCallback=s,this.xhr.send(null)},// Construction
this.xhr.open("GET",this.create_subscribe_url(i),!0),this.xhr.onreadystatechange=this.receive,this.xhr.parent=this,e){var r="Basic "+btoa(e.user+":"+e.pass);this.xhr.setRequestHeader("Authorization",r)}return this.scope=h,this}this.host=null,this.port="7379",this.auth=!1,this.setHost=function(s){this.host=s},this.setPort=function(s){this.port=s},this.setAuth=function(s,t){this.auth={user:s,pass:t}},this.$get=function(){var t=this.host,e=this.port,i=this.auth;return{subscribe:function(h,r){return new s(t,e,i,h,r)}}}});