/**
 * Adam Engebretson
 *
 * Adam Engebretson <http://github.com/adamgoose>
 * Created and maintained by Adam Engebretson
 *
 * Copyright (c) 2014 Adam Engebretson.
 * Licensed under the MIT License (MIT).
 */
!function(s){"use strict";s.service("WebdisSocket",["$timeout",function(){this.callbacks={},this.scopes={},this.init=function(s,t){this.socket=new WebSocket("ws://"+s+":"+t+"/");var i=this;return i.socket.onopen=function(){var s=["SUBSCRIBE"];angular.forEach(i.callbacks,function(t,i){s.push(i)}),i.socket.send(angular.toJson(s))},i.socket.onmessage=function(s){var t=angular.fromJson(s.data).SUBSCRIBE,o=t[0],n=t[1],e=t[2];"message"==o&&i.dispatchEvents(n,e)},this},this.dispatchEvents=function(s,t){var i;try{i=angular.fromJson(t)}catch(o){i=t}this.callbacks[s](i,s),angular.isDefined(this.scopes[s])&&this.scopes[s].$apply()},this.subscribe=function(s,t,i){this.callbacks[s]=t,this.scopes[s]=i,1==this.socket.readyState&&this.socket.send(angular.toJson(["SUBSCRIBE",s]))}}]),s.provider("Webdis",function(){this.host=null,this.port="7379",this.setHost=function(s){this.host=s},this.setPort=function(s){this.port=s},this.$get=["WebdisSocket",function(s){var t=this.host,i=this.port;return s.init(t,i)}]})}(angular.module("adamgoose.webdis",[]));