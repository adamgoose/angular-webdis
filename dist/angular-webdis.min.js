/**
 * Adam Engebretson
 *
 * Adam Engebretson <http://github.com/adamgoose>
 * Created and maintained by Adam Engebretson
 *
 * Copyright (c) 2014 Adam Engebretson.
 * Licensed under the MIT License (MIT).
 */
!function(t){"use strict";t.service("WebdisSocket",["$timeout",function(t){this.callbacks={},this.scopes={},this.init=function(t,s){this.socket=new WebSocket("ws://"+t+":"+s+"/");var i=this;return i.socket.onopen=function(){var t=["SUBSCRIBE"];angular.forEach(i.callbacks,function(s,i){t.push(i)}),i.socket.send(angular.toJson(t))},i.socket.onmessage=function(t){var s=angular.fromJson(t.data).SUBSCRIBE,n=s[0],o=s[1],e=s[2];"message"==n&&i.dispatchEvents(o,e)},this},this.dispatchEvents=function(t,s){var i;try{i=angular.fromJson(s)}catch(n){i=s}this.callbacks[t](i,t),angular.isDefined(this.scopes[t])&&this.scopes[t].$apply()},this.subscribe=function(s,i,n){if(this.callbacks[s]=i,this.scopes[s]=n,1==this.socket.readyState){var o=this.socket,e=10*this.callbacks.length;t(function(){o.send(angular.toJson(["SUBSCRIBE",s]))},e)}}}]),t.provider("Webdis",function(){this.host=null,this.port="7379",this.setHost=function(t){this.host=t},this.setPort=function(t){this.port=t},this.$get=["WebdisSocket",function(t){var s=this.host,i=this.port;return t.init(s,i)}]})}(angular.module("adamgoose.webdis",[]));