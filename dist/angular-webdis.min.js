/**
 * Adam Engebretson
 *
 * Adam Engebretson <http://github.com/adamgoose>
 * Created and maintained by Adam Engebretson
 *
 * Copyright (c) 2014 Adam Engebretson.
 * Licensed under the MIT License (MIT).
 */
"use strict";angular.module("adamgoose.webdis",[]).provider("Webdis",function(){this.host=null,this.port="7379",this.setHost=function(s){this.host=s},this.setPort=function(s){this.port=s},this.$get=function(){var s=this.host,t=this.port;return{xhr:new XMLHttpRequest,received:0,scope:null,messageCallback:function(){},subscribeCallback:function(){},subscribe:function(s,t){return this.xhr.open("GET",this.create_subscribe_url(s),!0),this.xhr.onreadystatechange=this.receive,this.xhr.parent=this,this.scope=t,this},create_subscribe_url:function(e){return"http://"+s+":"+t+"/SUBSCRIBE/"+e},receive:function(){if(3==this.readyState){var s=this.responseText,t=s.slice(this.parent.received);this.parent.received=s.length,t=angular.fromJson(t).SUBSCRIBE,this.parent.dispatchCallbacks(t)}},dispatchCallbacks:function(s){var t=s[0],e=s[1],i=s[2];switch(t){case"subscribe":this.subscribeCallback(i,e);break;case"message":this.messageCallback(i,e)}null!=this.scope&&this.scope.$apply()},onSubscribe:function(s){return this.subscribeCallback=s,this},onMessage:function(s){this.messageCallback=s,this.xhr.send(null)}}}});